--DROP TABLE BARCOS CASCADE CONSTRAINT;
--DROP TABLE CALADERO CASCADE CONSTRAINT;
--DROP TABLE ESPECIE CASCADE CONSTRAINT;
--DROP TABLE FECHAS_CAPTURAS_PERMITIDAS CASCADE CONSTRAINT;
--DROP TABLE LOTES CASCADE CONSTRAINT;

CREATE TABLE BARCOS
(
	MATRICULA VARCHAR2(10),
	NOMBRE VARCHAR2(10),
	CLASE VARCHAR2(10),
	ARMADOR VARCHAR2(10),
	CAPACIDAD NUMBER(5,2),
	NACIONALIDAD VARCHAR2(10),
CONSTRAINT PK_BARCOS PRIMARY KEY (MATRICULA),
CONSTRAINT CHK1_BARCOS CHECK (REGEXP_LIKE(MATRICULA, '^[A-Z][A-Z]-[0-9]{4}'))
);

CREATE TABLE CALADERO
(
	CODIGO VARCHAR2(10),
	NOMBRE VARCHAR2(10),
	UBICACION VARCHAR2(10),
	ESPECIE_PRINCIPAL VARCHAR2(10),
CONSTRAINT PK_CALADERO PRIMARY KEY (CODIGO),
CONSTRAINT CHK_CALADERO CHECK((UPPER(NOMBRE)=NOMBRE) AND (UPPER(UBICACION)=UBICACION))
);

CREATE TABLE ESPECIE
(
	CODIGO VARCHAR2(10),
	NOMBRE VARCHAR2(10),
	TIPO VARCHAR2(10),
	CUPOBARCO VARCHAR2(10),
	CALADERO_PRINCIPAL VARCHAR2(10),
CONSTRAINT PK_ESPECIE PRIMARY KEY (CODIGO),
CONSTRAINT FK_ESPECIE FOREIGN KEY (CALADERO_PRINCIPAL) REFERENCES CALADERO(CODIGO)
);

ALTER TABLE CALADERO ADD CONSTRAINT FK_CALADERO FOREIGN KEY (ESPECIE_PRINCIPAL) REFERENCES ESPECIE(CODIGO) ON DELETE SET NULL;


CREATE TABLE LOTES 
(
	CODIGO VARCHAR2(10),
	MATRICULA VARCHAR2(10),
	NUMKILOS NUMBER(5,2),
	PRECIOPORKILOSALIDA NUMBER(5,2),
	PRECIOPORKILOADJUDICADO NUMBER(5,2),
	FECHAVENTA DATE NOT NULL,
	COD_ESPECIE VARCHAR2(10),
CONSTRAINT PK_LOTES PRIMARY KEY (CODIGO),
CONSTRAINT FK1_LOTES FOREIGN KEY (MATRICULA) REFERENCES BARCOS(MATRICULA) ON DELETE CASCADE,
CONSTRAINT FK2_LOTES FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIE(CODIGO) ON DELETE CASCADE,
CONSTRAINT CHK_LOTES CHECK (PRECIOPORKILOADJUDICADO > PRECIOPORKILOSALIDA),
CONSTRAINT CHK2_LOTES CHECK ((NUMKILOS>0) AND (PRECIOPORKILOSALIDA>0) AND (PRECIOPORKILOADJUDICADO>0))
);


CREATE TABLE FECHAS_CAPTURAS_PERMITIDAS
(
	COD_ESPECIE VARCHAR2(10),
	COD_CALADERO VARCHAR2(10),
	FECHA_INICIAL DATE,
	FECHA_FINAL DATE,
CONSTRAINT PF_FECHAS_CAPTURAS_PERMITIDAS PRIMARY KEY (COD_ESPECIE, COD_CALADERO),
CONSTRAINT FK1_FECHAS_CAPTURAS_PERMITIDAS FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIE(CODIGO),
CONSTRAINT FK2_FECHAS_CAPTURAS_PERMITIDAS FOREIGN KEY (COD_CALADERO) REFERENCES CALADERO(CODIGO),
CONSTRAINT CHK3_LOTES CHECK (TO_CHAR(FECHA_INICIAL, 'MM/DD') <'02/02' OR (TO_CHAR(FECHA_INICIAL, 'MM/DD')>'03/28')),
CONSTRAINT CHK4_LOTES CHECK (TO_CHAR(FECHA_FINAL, 'MM/DD') <'02/02' OR (TO_CHAR(FECHA_FINAL, 'MM/DD')>'03/28'))
);
;

ALTER TABLE CALADERO ADD NOMBRE_CIENFITICO VARCHAR2(10);

INSERT INTO BARCOS 
VALUES ('FS-0236', 'FOCUS', 'DIESEL','ANTONIO', 30.00,'ESP');
INSERT INTO BARCOS 
VALUES ('JB-2063', '2008', 'DIESEL','MANUEL',38.00 ,'ESP');
INSERT INTO CALADERO 
VALUES ('1', 'ASTILL', 'CADIZ',NULL, 'HOLA');
INSERT INTO CALADERO 
VALUES ('2', 'ASTILL', 'CADIZ',NULL, 'PEPE');
INSERT INTO ESPECIE 
VALUES ('1', 'MERO', 'CHORDATA','10%','1');
INSERT INTO ESPECIE 
VALUES ('2', 'SEPIA', 'MOLLUSCA','10%', '2');
INSERT INTO LOTES 
VALUES ('1', 'FS-0236', 100.2, 13.10, 15.10, SYSDATE, '1');
INSERT INTO LOTES 
VALUES ('2', 'JB-2063', 90.8, 9.20, 11.20, SYSDATE, '2');
INSERT INTO FECHAS_CAPTURAS_PERMITIDAS 
VALUES ('1', '1',TO_DATE('07/23','MM/DD'), TO_DATE('07/24','MM/DD'));
INSERT INTO FECHAS_CAPTURAS_PERMITIDAS 
VALUES ('2', '2',TO_DATE('06/23','MM/DD'), TO_DATE('06/24','MM/DD'));
UPDATE CALADERO 
SET ESPECIE_PRINCIPAL='1' WHERE CODIGO='1';
UPDATE CALADERO 
SET ESPECIE_PRINCIPAL='2' WHERE CODIGO='2';

ALTER TABLE BARCOS DROP COLUMN ARMADOR;











